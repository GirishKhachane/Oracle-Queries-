WITH TBL as
 (select /*+ materialize */
   t.owner, table_name, round(sum(bytes) / 1024 / 1024, 2) "TAB_SIZE_MB"
    from dba_tables t, dba_segments s
   where t.table_name = s.segment_name and t.owner = s.owner
     and t.owner in
         ('DB_SCHEMA')
   group by t.owner, table_name
   order by 2 desc),
IDX as
 (select /*+ materialize */
   i.owner, table_name, round(sum(bytes) / 1024 / 1024, 2) "INDEX_SIZE_MB"
    from dba_indexes i, dba_segments s
   where i.index_name = s.segment_name and i.owner = s.owner
     and i.owner in
         ('DB_SCHEMA')
   group by i.owner, table_name
   order by 2 desc),
LOBS as
 (select /*+ materialize */
   l.owner, l.table_name, round(sum(bytes) / 1024 / 1024, 2) "LOB_SIZE_MB"
    from dba_lobs l, dba_segments s
   where l.segment_name = s.segment_name and l.owner = s.owner
     and l.owner in
         ('DB_SCHEMA')
   group by l.owner, table_name
   order by 2 desc),
STAT as
 (select /*+ materialize */ owner,
       table_name,
       sum(greatest(nvl(num_rows,0), nvl(sample_size,0))) num_rows,
       avg(avg_row_len) avg_row_len,
       max(last_analyzed) last_analyzed,
       max(nvl(stale_stats,'N')) stale_stats
  from dba_tab_statistics
 where owner in ('DB_SCHEMA') 
 group by owner,
          table_name)
select T.owner,
       T.table_name,
       T.TAB_SIZE_MB,
       NVL(I.INDEX_SIZE_MB, 0) IND_SIZE_MB,
       NVL(L.LOB_SIZE_MB, 0) LOB_SIZE_MB,
       (T.TAB_SIZE_MB + NVL(I.INDEX_SIZE_MB, 0) + NVL(L.LOB_SIZE_MB, 0)) TOTAL_SIZE_MB,
       s.num_rows,
       s.stale_stats,
       s.avg_row_len,
       s.last_analyzed
  from TBL T, IDX I, LOBS L, STAT S
 where T.table_name = I.table_name(+)
   and T.table_name = L.table_name(+)
   and T.owner = I.owner(+)
   and T.owner = L.owner(+)
   and T.table_name = S.table_name(+)
   and T.owner = S.owner(+)
 order by 1, 6 desc;
